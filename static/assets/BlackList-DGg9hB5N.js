import{a as F,_ as P,R as j}from"./usePaginatedResource-CT70F4ic.js";import{ac as k,q as z,y as m,B as G,j as o,D as s,X as l,G as v,ad as H,L as x,U as B,J as C,ae as J,H as Q,Y as X,af as _}from"./index-eFRUYAX7.js";import{c as Y,d as K}from"./index-DZXexlSu.js";import{B as W}from"./Col-BLc3TCIj.js";import{F as Z,_ as ee}from"./index-BeJdP8-t.js";import{a as ae,I as te}from"./index-1fK8aAIM.js";const oe=async({page:u,pageSize:r,search:d})=>{const i={limit:r,offset:(u-1)*r};d&&(i.search=d);const{data:a}=await k.get("blacklist",{params:i});if(!a||!Array.isArray(a.records))throw new Error((a==null?void 0:a.message)||"黑名单数据格式不正确");return{items:a.records,total:a.total??a.records.length}},ne=({userId:u,reason:r})=>k.post("blacklist",{userId:u,reason:r}),se=u=>k.delete(`blacklist/${u}`),le={class:"blacklist-container"},re={__name:"BlackList",setup(u){const r=m(!1),d=m(!1),i=m(""),a=m(""),{items:y,loading:h,searchQuery:f,searchLoading:I,pagination:R,handleSearch:D,handleTableChange:U,refresh:g}=F(oe,{initialPageSize:10}),$=[{title:"用户",dataIndex:"user",key:"user",width:200},{title:"原因",dataIndex:"reason",key:"reason",ellipsis:!0,width:300},{title:"操作",key:"action",width:150,fixed:"right"}],L=()=>g(),S=()=>{i.value="",a.value="",r.value=!0},A=async()=>{var p,e;if(!i.value||!a.value){_.warning("请填写用户ID和原因");return}d.value=!0;try{const{data:t}=await ne({userId:i.value,reason:a.value});if(t.success)_.success(`已添加用户 ${i.value}`),r.value=!1,await g();else throw new Error((t==null?void 0:t.message)||"添加失败")}catch(t){_.error(`添加黑名单失败: ${((e=(p=t.response)==null?void 0:p.data)==null?void 0:e.message)||t.message||"未知错误"}`)}finally{d.value=!1}},E=async p=>{var e,t;try{const{data:n}=await se(p.id);if(n.success)_.success(`已移除用户 ${p.user} 从黑名单`),await g();else throw new Error((n==null?void 0:n.message)||"移除失败")}catch(n){_.error(`移除黑名单失败: ${((t=(e=n.response)==null?void 0:e.data)==null?void 0:t.message)||n.message||"未知错误"}`)}};return(p,e)=>{const t=ae,n=W,N=Y,O=J,V=P,w=te,b=ee,q=Z,M=K;return v(),G("div",le,[o(N,{style:{"margin-bottom":"16px"}},{default:s(()=>[o(t,{value:l(f),"onUpdate:value":e[0]||(e[0]=c=>H(f)?f.value=c:null),placeholder:"搜索黑名单用户",style:{width:"200px"},onSearch:l(D),loading:l(I)},null,8,["value","onSearch","loading"]),o(n,{onClick:L},{icon:s(()=>[o(l(j))]),_:1}),o(n,{type:"primary",onClick:S},{default:s(()=>e[4]||(e[4]=[x("添加")])),_:1})]),_:1}),o(V,{columns:$,"data-source":l(y),pagination:l(R),loading:l(h),"row-key":"id",onChange:l(U),scroll:{x:800,y:500}},{emptyText:s(()=>[l(h)?C("",!0):(v(),B(O,{key:0,description:"暂无数据"},{description:s(()=>[Q("span",null,X(l(y).length===0?"当前没有黑名单用户":"没有匹配的数据"),1)]),_:1}))]),bodyCell:s(({column:c,record:T})=>[c.key==="action"?(v(),B(n,{key:0,size:"small",danger:"",onClick:ie=>E(T)},{default:s(()=>e[5]||(e[5]=[x("移除")])),_:2},1032,["onClick"])):C("",!0)]),_:1},8,["data-source","pagination","loading","onChange"]),o(M,{open:r.value,"onUpdate:open":e[3]||(e[3]=c=>r.value=c),title:"添加黑名单用户",onOk:A,"confirm-loading":d.value},{default:s(()=>[o(q,{"label-col":{span:4},"wrapper-col":{span:20}},{default:s(()=>[o(b,{label:"用户ID",required:""},{default:s(()=>[o(w,{value:i.value,"onUpdate:value":e[1]||(e[1]=c=>i.value=c),placeholder:"请输入用户ID"},null,8,["value"])]),_:1}),o(b,{label:"原因",required:""},{default:s(()=>[o(w,{value:a.value,"onUpdate:value":e[2]||(e[2]=c=>a.value=c),placeholder:"请输入添加原因"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["open","confirm-loading"])])}}},fe=z(re,[["__scopeId","data-v-598b91d8"]]);export{fe as default};
